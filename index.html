<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Erbha</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Telegram Mini App -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Monetag SDK -->
  <script src='//libtl.com/sdk.js'
          data-zone='10376707'
          data-sdk='show_10376707'></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #ffffff;
      text-align: center;
    }
    .box { padding: 30px; }
    h1 { color: #22c55e; font-size: 36px; margin: 10px 0; }
    .card {
      max-width: 420px;
      margin: 0 auto;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 16px;
      padding: 18px;
      margin-top: 18px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      margin-top: 10px;
    }
    .badge {
      background: rgba(34,197,94,0.15);
      border: 1px solid rgba(34,197,94,0.35);
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: bold;
      color: #a7f3d0;
    }
    button {
      background: #22c55e;
      border: none;
      padding: 14px 22px;
      font-size: 16px;
      border-radius: 14px;
      cursor: pointer;
      color: #000;
      font-weight: 700;
      width: 100%;
      margin-top: 14px;
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    .small { font-size: 12px; opacity: 0.7; margin-top: 10px; }
    .msg { margin-top: 12px; font-size: 13px; opacity: 0.9; min-height: 18px; }
    .danger { color: #fca5a5; }
    .ok { color: #86efac; }
  </style>
</head>

<body>
  <div class="box">
    <h1>üéÆ Erbha</h1>
    <p style="opacity:.85;margin-top:0">Play ‚Äì Earn ‚Äì Win</p>

    <div class="card">
      <div class="row">
        <div style="opacity:.85">Your Points</div>
        <div class="badge"><span id="points">0</span> ‚≠ê</div>
      </div>

      <button id="btnRewarded" onclick="watchRewardedAd()">üëÄ Watch Ad & Earn</button>

      <div class="msg" id="msg"></div>
      <div class="small">Tip: Ads appear after user interaction (button click).</div>
    </div>
  </div>

  <script>
    // --- Simple local points (for now) ---
    // NOTE: This stores points on the same device/browser only.
    const POINTS_KEY = "erbha_points";
    const pointsEl = document.getElementById("points");
    const msgEl = document.getElementById("msg");
    const btn = document.getElementById("btnRewarded");

    function getPoints() {
      return Number(localStorage.getItem(POINTS_KEY) || "0");
    }
    function setPoints(v) {
      localStorage.setItem(POINTS_KEY, String(v));
      pointsEl.textContent = String(v);
    }
    function addPoints(amount) {
      setPoints(getPoints() + amount);
    }
    function setMsg(text, cls) {
      msgEl.className = "msg " + (cls || "");
      msgEl.textContent = text || "";
    }

    // Load initial points
    setPoints(getPoints());

    // Telegram: expand mini app (optional)
    try {
      if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
      }
    } catch (e) {}

    // --- Monetag Rewarded Interstitial ---
    async function watchRewardedAd() {
      setMsg("");
      btn.disabled = true;

      // Ensure Monetag function is loaded
      if (typeof show_10376707 !== "function") {
        setMsg("Ad is still loading. Try again in 5 seconds.", "danger");
        btn.disabled = false;
        return;
      }

      try {
        // Rewarded interstitial (as Monetag provided)
        await show_10376707();

        // ‚úÖ Reward user AFTER ad watched
        addPoints(5); // ÿ∫Ÿäÿ± ÿßŸÑÿ±ŸÇŸÖ ÿ≠ÿ≥ÿ® ŸÜÿ∏ÿßŸÖŸÉ (ŸÖÿ´ŸÑÿß 1 ÿ£Ÿà 10)
        setMsg("‚úÖ Ad completed! +5 points added.", "ok");
      } catch (e) {
        // user closed / error happened
        setMsg("‚ùå No reward (ad closed or failed). Try again later.", "danger");
      } finally {
        btn.disabled = false;
      }
    }

    // OPTIONAL: Rewarded Popup example (ŸÑŸà ÿ≠ÿ®Ÿäÿ™ ÿ™ÿ≥ÿ™ÿÆÿØŸÖŸá ÿ®ÿØŸÑ interstitial)
    // async function watchPopupAd() {
    //   btn.disabled = true;
    //   try {
    //     await show_10376707('pop');
    //     addPoints(3);
    //     setMsg("‚úÖ Popup ad completed! +3 points.", "ok");
    //   } catch (e) {
    //     setMsg("‚ùå Popup ad closed/failed.", "danger");
    //   } finally {
    //     btn.disabled = false;
    //   }
    // }

  </script>
</body>
</html>
